---
title: å‰ç«¯æ€§èƒ½ä¼˜åŒ–å®æˆ˜
desc: è®©ä½ çš„ React åº”ç”¨è·‘å¾—æ›´å¿«çš„ 10 ä¸ªæŠ€å·§
date: 2024-01-05
icon: âš¡
tags:
  - æ€§èƒ½ä¼˜åŒ–
  - React
  - å‰ç«¯å¼€å‘
  - æœ€ä½³å®è·µ
  - å®æˆ˜
---

æ€§èƒ½ä¼˜åŒ–æ˜¯å‰ç«¯å¼€å‘ä¸­æ°¸æ’çš„è¯é¢˜ã€‚æœ¬æ–‡å°†åˆ†äº«ç»è¿‡å®è·µéªŒè¯çš„æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼Œè®©ä½ çš„Reactåº”ç”¨æ›´å¿«é€Ÿã€æ›´æµç•…ã€‚

## ğŸ“‹ ç›®å½•

- [ä»£ç åˆ†å‰²](#ä»£ç åˆ†å‰²)
- [ç»„ä»¶ä¼˜åŒ–](#ç»„ä»¶ä¼˜åŒ–)
- [æ¸²æŸ“ä¼˜åŒ–](#æ¸²æŸ“ä¼˜åŒ–)
- [èµ„æºä¼˜åŒ–](#èµ„æºä¼˜åŒ–)
- [ç›‘æ§åˆ†æ](#ç›‘æ§åˆ†æ)

## ä»£ç åˆ†å‰²

### è·¯ç”±çº§åˆ«çš„åˆ†å‰²

ä½¿ç”¨React.lazyå’ŒSuspenseï¼š

```javascript
import { lazy, Suspense } from 'react';

const Home = lazy(() => import('./pages/Home'));
const About = lazy(() => import('./pages/About'));

function App() {
  return (
    <Suspense fallback={<div>åŠ è½½ä¸­...</div>}>
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/about" element={<About />} />
      </Routes>
    </Suspense>
  );
}
```

### ç»„ä»¶çº§åˆ«çš„åˆ†å‰²

```javascript
const HeavyComponent = lazy(() => import('./HeavyComponent'));

function App() {
  const [showHeavy, setShowHeavy] = useState(false);
  
  return (
    <div>
      <button onClick={() => setShowHeavy(true)}>
        åŠ è½½é‡å‹ç»„ä»¶
      </button>
      {showHeavy && (
        <Suspense fallback={<div>åŠ è½½ä¸­...</div>}>
          <HeavyComponent />
        </Suspense>
      )}
    </div>
  );
}
```

## ç»„ä»¶ä¼˜åŒ–

### 1. React.memo()

é˜²æ­¢ä¸å¿…è¦çš„é‡æ¸²æŸ“ï¼š

```javascript
const ExpensiveComponent = React.memo(({ data }) => {
  console.log('æ¸²æŸ“äº†');
  return <div>{/* å¤æ‚æ¸²æŸ“ */}</div>;
}, (prevProps, nextProps) => {
  // è‡ªå®šä¹‰æ¯”è¾ƒé€»è¾‘
  return prevProps.data.id === nextProps.data.id;
});
```

### 2. useMemo() - ç¼“å­˜è®¡ç®—ç»“æœ

```javascript
function ProductList({ products }) {
  // æ˜‚è´µè®¡ç®—åªæ‰§è¡Œä¸€æ¬¡
  const sortedProducts = useMemo(() => {
    return products.sort((a, b) => b.price - a.price);
  }, [products]);
  
  return (
    <div>
      {sortedProducts.map(product => (
        <ProductItem key={product.id} product={product} />
      ))}
    </div>
  );
}
```

### 3. useCallback() - ç¼“å­˜å‡½æ•°å¼•ç”¨

```javascript
function Parent({ data }) {
  // å‡½æ•°åªåˆ›å»ºä¸€æ¬¡
  const handleClick = useCallback((id) => {
    console.log('ç‚¹å‡»äº†', id);
  }, []);
  
  return (
    <div>
      {data.map(item => (
        <Child key={item.id} onClick={handleClick} />
      ))}
    </div>
  );
}
```

## æ¸²æŸ“ä¼˜åŒ–

### è™šæ‹Ÿåˆ—è¡¨

å¤„ç†å¤§é‡æ•°æ®ï¼š

```javascript
import { useVirtualizer } from '@tanstack/react-virtual';

function VirtualList({ items }) {
  const parentRef = useRef(null);
  
  const virtualizer = useVirtualizer({
    count: items.length,
    getScrollElement: () => parentRef.current,
    estimateSize: () => 50,
  });
  
  return (
    <div ref={parentRef} style={{ height: '400px', overflow: 'auto' }}>
      <div style={{ height: `${virtualizer.getTotalSize()}px` }}>
        {virtualizer.getVirtualItems().map(virtualItem => (
          <div
            key={virtualItem.key}
            style={{
              position: 'absolute',
              top: 0,
              left: 0,
              width: '100%',
              height: virtualItem.size,
              transform: `translateY(${virtualItem.start}px)`,
            }}
          >
            {items[virtualItem.index]}
          </div>
        ))}
      </div>
    </div>
  );
}
```

### å›¾ç‰‡æ‡’åŠ è½½

```javascript
const LazyImage = ({ src, alt }) => {
  const [imageSrc, setImageSrc] = useState(null);
  const imgRef = useRef(null);
  
  useEffect(() => {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          setImageSrc(src);
          observer.disconnect();
        }
      });
    });
    
    if (imgRef.current) {
      observer.observe(imgRef.current);
    }
    
    return () => observer.disconnect();
  }, [src]);
  
  return <img ref={imgRef} src={imageSrc || 'placeholder.jpg'} alt={alt} />;
};
```

## èµ„æºä¼˜åŒ–

### å›¾ç‰‡ä¼˜åŒ–

```javascript
// ä½¿ç”¨WebPæ ¼å¼
<picture>
  <source srcSet="image.webp" type="image/webp" />
  <img src="image.jpg" alt="æè¿°" />
</picture>

// å“åº”å¼å›¾ç‰‡
<img
  srcSet="image-300w.jpg 300w, image-600w.jpg 600w, image-900w.jpg 900w"
  sizes="(max-width: 600px) 300px, (max-width: 900px) 600px, 900px"
  src="image-900w.jpg"
  alt="æè¿°"
/>
```

### CSSä¼˜åŒ–

```scss
// é¿å…æ·±åº¦åµŒå¥—
// âŒ ä¸å¥½çš„åšæ³•
.container {
  .wrapper {
    .content {
      .text {
        color: red;
      }
    }
  }
}

// âœ… å¥½çš„åšæ³•
.container-text {
  color: red;
}

// ä½¿ç”¨CSSå˜é‡
:root {
  --primary-color: #00ff00;
  --secondary-color: #ffffff;
}

.terminal {
  color: var(--primary-color);
}
```

### å­—ä½“ä¼˜åŒ–

```css
/* ä½¿ç”¨font-display: swap */
@font-face {
  font-family: 'CustomFont';
  src: url('font.woff2') format('woff2');
  font-display: swap; /* ä¼˜åŒ–å­—ä½“åŠ è½½ */
}
```

## ç›‘æ§åˆ†æ

### Web Vitals

```javascript
import { onCLS, onFID, onLCP } from 'web-vitals';

function sendToAnalytics(metric) {
  // å‘é€åˆ°åˆ†ææœåŠ¡
  console.log(metric);
}

onCLS(sendToAnalytics); // Cumulative Layout Shift
onFID(sendToAnalytics); // First Input Delay
onLCP(sendToAnalytics); // Largest Contentful Paint
```

### Performance API

```javascript
// æµ‹é‡ä»£ç æ‰§è¡Œæ—¶é—´
function measurePerformance(name, fn) {
  performance.mark(`${name}-start`);
  fn();
  performance.mark(`${name}-end`);
  performance.measure(name, `${name}-start`, `${name}-end`);
  
  const measure = performance.getEntriesByName(name)[0];
  console.log(`${name}: ${measure.duration}ms`);
}

measurePerformance('heavy-computation', () => {
  // æ‰§è¡Œè€—æ—¶æ“ä½œ
});
```

## æ€»ç»“

æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼š

âœ… **æµ‹é‡** - å…ˆæµ‹é‡ï¼Œåä¼˜åŒ–
âœ… **ä¼˜å…ˆçº§** - ä¼˜åŒ–å½±å“æœ€å¤§çš„éƒ¨åˆ†
âœ… **å¹³è¡¡** - åœ¨æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ä¹‹é—´æ‰¾å¹³è¡¡
âœ… **ç›‘æ§** - æŒç»­ç›‘æ§æ€§èƒ½æŒ‡æ ‡

è®°ä½ï¼šè¿‡æ—©ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æºï¼Œä½†è¦å…³æ³¨ç”¨æˆ·ä½“éªŒï¼

---

**å·¥å…·æ¨è**ï¼š
- Chrome DevTools
- Lighthouse
- WebPageTest
- React DevTools Profiler

